openapi: 3.1.0
$schema: "https://spec.openapis.org/oas/3.1.0"
info:
  title: SOL Trading Gateway - SharpSignalEngine API
  description: >
    Institutional-grade SOL/USDT perpetual futures trading intelligence with an
    8-layer confluence engine (SMC, Order Flow, CVD, Volume Profile, Fibonacci,
    Funding, Open Interest, Technicals). Optimized for GPT Actions.
  version: "1.0.0"
  termsOfService: "https://guardiansofthegreentoken.com/terms"
  x-privacyPolicyUrl: "https://guardiansofthegreentoken.com/privacy"
  contact:
    name: Guardians of the Green Token
    url: https://guardiansofthegreentoken.com
    email: ops@guardiansofthegreentoken.com
  license:
    name: "Proprietary — SOL Trading Gateway"
    url: "https://guardiansofthegreentoken.com/license"

servers:
  - url: https://guardiansofthegreentoken.com
    description: Production server

paths:
  /health:
    get:
      operationId: get_health
      summary: System health check
      description: Check overall system health and connectivity status.
      responses:
        "200":
          description: System operational
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/HealthResponse"

  /api/sol/complete:
    get:
      operationId: getApiSolComplete
      summary: Complete SOL market analysis
      description: >
        Comprehensive SOL/USDT snapshot including ticker, orderbook, candles,
        and recent trades.
      responses:
        "200":
          description: Complete market data
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/CompleteResponse"

  /api/sol/confluence:
    get:
      operationId: getApiSolConfluence
      summary: SharpSignalEngine confluence analysis
      description: 8-layer institutional confluence score with trend & confidence.
      responses:
        "200":
          description: Confluence analysis
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ConfluenceResponse"

  /api/sol/cvd:
    get:
      operationId: getApiSolCvd
      summary: Cumulative Volume Delta analysis
      description: Advanced CVD metrics with divergence detection.
      responses:
        "200":
          description: CVD analysis
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/CvdResponse"

  /api/sol/smc:
    get:
      operationId: getApiSolSmc
      summary: Smart Money Concepts analysis
      description: BOS/CHoCH detection with smart money flow and structure regime.
      responses:
        "200":
          description: Smart Money analysis
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SmcResponse"

  /api/sol/order-flow:
    get:
      operationId: getApiSolOrderFlow
      summary: Order flow analysis
      description: Tape reading, maker/taker balance, whale blocks, flow strength.
      responses:
        "200":
          description: Order flow data
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/OrderFlowResponse"

  /api/sol/volume-profile:
    get:
      operationId: getApiSolVolumeProfile
      summary: Volume profile analysis
      description: POC/VPOC, value area, HVN/LVN clusters.
      responses:
        "200":
          description: Volume profile data
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/VolumeProfileResponse"

  /api/sol/fibonacci:
    get:
      operationId: getApiSolFibonacci
      summary: Fibonacci retracement & extensions
      description: Multi-swing retracement zones and 127/161/261 extensions.
      responses:
        "200":
          description: Fibonacci levels
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/FibonacciResponse"

  /api/sol/funding:
    get:
      operationId: getApiSolFunding
      summary: Funding rate analysis
      description: Current funding, premium index, next funding time.
      responses:
        "200":
          description: Funding rate data
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/FundingResponse"

  /api/sol/open-interest:
    get:
      operationId: getApiSolOpenInterest
      summary: Open interest analysis
      description: Derivatives positioning (contracts & notional).
      responses:
        "200":
          description: Open interest data
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/OpenInterestResponse"

  /api/sol/technical:
    get:
      operationId: getApiSolTechnical
      summary: Technical indicators
      description: RSI, EMA stack, momentum summary, confluence score.
      responses:
        "200":
          description: Technical indicators
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/TechnicalResponse"

components:
  schemas:
    SuccessFlag:
      type: object
      properties:
        success:
          type: boolean
          description: Indicates operation success.

    HealthResponse:
      allOf:
        - $ref: "#/components/schemas/SuccessFlag"
        - type: object
          properties:
            data:
              type: object
              properties:
                status:
                  type: string
                  example: "operational"
                services:
                  type: object
                  properties:
                    okx:
                      type: string
                      example: "connected"
                    api:
                      type: string
                      example: "operational"
                metrics:
                  type: object
                  properties:
                    responseTime:
                      type: number
                      example: 331
                    requestsToday:
                      type: number
                      example: 1234
                    uptime:
                      type: string
                      example: "2d14h"

    CompleteResponse:
      allOf:
        - $ref: "#/components/schemas/SuccessFlag"
        - type: object
          properties:
            data:
              type: object
              properties:
                ticker:
                  type: object
                  additionalProperties: true
                orderbook:
                  type: object
                  additionalProperties: true
                candlesticks:
                  type: object
                  additionalProperties: true
                trades:
                  type: array
                  items:
                    type: object
                    additionalProperties: true

    ConfluenceResponse:
      allOf:
        - $ref: "#/components/schemas/SuccessFlag"
        - type: object
          properties:
            data:
              type: object
              properties:
                overall:
                  type: number
                  description: 0–100 scale
                trend:
                  type: string
                  enum: [bullish, bearish, neutral]
                confidence:
                  type: number
                  description: 0–100 institutional confidence
                layers:
                  type: object
                  additionalProperties: true

    CvdResponse:
      allOf:
        - $ref: "#/components/schemas/SuccessFlag"
        - type: object
          properties:
            data:
              type: object
              properties:
                current:
                  type: number
                confidence:
                  type: number
                trend:
                  type: string
                  enum: [bullish, bearish, neutral]
                divergence:
                  type: object
                  additionalProperties: true

    SmcResponse:
      allOf:
        - $ref: "#/components/schemas/SuccessFlag"
        - type: object
          properties:
            data:
              type: object
              properties:
                trend:
                  type: string
                  enum: [bullish, bearish, neutral, ranging]
                structure:
                  type: string
                  example: "bearish-regime"
                bos:
                  type: object
                  additionalProperties: true
                choch:
                  type: object
                  additionalProperties: true

    OrderFlowResponse:
      allOf:
        - $ref: "#/components/schemas/SuccessFlag"
        - type: object
          properties:
            data:
              type: object
              properties:
                buyPressure:
                  type: number
                sellPressure:
                  type: number
                flow:
                  type: string
                  enum: [bullish, bearish, neutral]
                whales:
                  type: array
                  items:
                    type: object
                    additionalProperties: true

    VolumeProfileResponse:
      allOf:
        - $ref: "#/components/schemas/SuccessFlag"
        - type: object
          properties:
            data:
              type: object
              properties:
                poc:
                  type: number
                vpoc:
                  type: number
                  nullable: true
                valueArea:
                  type: object
                  properties:
                    low: { type: number }
                    high: { type: number }
                hvn:
                  type: array
                  items: { type: number }
                lvn:
                  type: array
                  items: { type: number }

    FibonacciResponse:
      allOf:
        - $ref: "#/components/schemas/SuccessFlag"
        - type: object
          properties:
            data:
              type: object
              properties:
                swings:
                  type: object
                  properties:
                    current:
                      type: object
                      properties:
                        low: { type: number }
                        high: { type: number }
                    previous:
                      type: object
                      properties:
                        low: { type: number }
                        high: { type: number }
                retracements:
                  type: object
                  additionalProperties: { type: number }
                extensions:
                  type: object
                  additionalProperties: { type: number }

    FundingResponse:
      allOf:
        - $ref: "#/components/schemas/SuccessFlag"
        - type: object
          properties:
            data:
              type: object
              properties:
                fundingRate:
                  type: number
                premiumIndex:
                  type: number
                nextFundingTime:
                  type: string
                  format: date-time
                rangeLimits:
                  type: object
                  properties:
                    min: { type: number }
                    max: { type: number }

    OpenInterestResponse:
      allOf:
        - $ref: "#/components/schemas/SuccessFlag"
        - type: object
          properties:
            data:
              type: object
              properties:
                contracts:
                  type: number
                notionalUsd:
                  type: number
                instrument:
                  type: string

    TechnicalResponse:
      allOf:
        - $ref: "#/components/schemas/SuccessFlag"
        - type: object
          properties:
            data:
              type: object
              properties:
                rsi:
                  type: object
                  properties:
                    current: { type: number }
                    trend: { type: string }
                ema:
                  type: object
                  additionalProperties: true
                momentumSummary:
                  type: object
                  additionalProperties: true
                confluenceScore:
                  type: number

security: []   # no auth for public-read endpoints; add apiKey/oauth here if needed
